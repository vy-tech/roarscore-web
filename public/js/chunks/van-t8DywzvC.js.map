{"version":3,"file":"van-t8DywzvC.js","sources":["../../../node_modules/vanjs-core/src/van.js"],"sourcesContent":["// This file consistently uses `let` keyword instead of `const` for reducing the bundle size.\n\n// Global variables - aliasing some builtin symbols to reduce the bundle size.\nlet protoOf = Object.getPrototypeOf\nlet changedStates, derivedStates, curDeps, curNewDerives, alwaysConnectedDom = {isConnected: 1}\nlet gcCycleInMs = 1000, statesToGc, propSetterCache = {}\nlet objProto = protoOf(alwaysConnectedDom), funcProto = protoOf(protoOf), _undefined\n\nlet addAndScheduleOnFirst = (set, s, f, waitMs) =>\n  (set ?? (setTimeout(f, waitMs), new Set)).add(s)\n\nlet runAndCaptureDeps = (f, deps, arg) => {\n  let prevDeps = curDeps\n  curDeps = deps\n  try {\n    return f(arg)\n  } catch (e) {\n    console.error(e)\n    return arg\n  } finally {\n    curDeps = prevDeps\n  }\n}\n\nlet keepConnected = l => l.filter(b => b._dom?.isConnected)\n\nlet addStatesToGc = d => statesToGc = addAndScheduleOnFirst(statesToGc, d, () => {\n  for (let s of statesToGc)\n    s._bindings = keepConnected(s._bindings),\n    s._listeners = keepConnected(s._listeners)\n  statesToGc = _undefined\n}, gcCycleInMs)\n\nlet stateProto = {\n  get val() {\n    curDeps?._getters?.add(this)\n    return this.rawVal\n  },\n\n  get oldVal() {\n    curDeps?._getters?.add(this)\n    return this._oldVal\n  },\n\n  set val(v) {\n    curDeps?._setters?.add(this)\n    if (v !== this.rawVal) {\n      this.rawVal = v\n      this._bindings.length + this._listeners.length ?\n        (derivedStates?.add(this), changedStates = addAndScheduleOnFirst(changedStates, this, updateDoms)) :\n        this._oldVal = v\n    }\n  },\n}\n\nlet state = initVal => ({\n  __proto__: stateProto,\n  rawVal: initVal,\n  _oldVal: initVal,\n  _bindings: [],\n  _listeners: [],\n})\n\nlet bind = (f, dom) => {\n  let deps = {_getters: new Set, _setters: new Set}, binding = {f}, prevNewDerives = curNewDerives\n  curNewDerives = []\n  let newDom = runAndCaptureDeps(f, deps, dom)\n  newDom = (newDom ?? document).nodeType ? newDom : new Text(newDom)\n  for (let d of deps._getters)\n    deps._setters.has(d) || (addStatesToGc(d), d._bindings.push(binding))\n  for (let l of curNewDerives) l._dom = newDom\n  curNewDerives = prevNewDerives\n  return binding._dom = newDom\n}\n\nlet derive = (f, s = state(), dom) => {\n  let deps = {_getters: new Set, _setters: new Set}, listener = {f, s}\n  listener._dom = dom ?? curNewDerives?.push(listener) ?? alwaysConnectedDom\n  s.val = runAndCaptureDeps(f, deps, s.rawVal)\n  for (let d of deps._getters)\n    deps._setters.has(d) || (addStatesToGc(d), d._listeners.push(listener))\n  return s\n}\n\nlet add = (dom, ...children) => {\n  for (let c of children.flat(Infinity)) {\n    let protoOfC = protoOf(c ?? 0)\n    let child = protoOfC === stateProto ? bind(() => c.val) :\n      protoOfC === funcProto ? bind(c) : c\n    child != _undefined && dom.append(child)\n  }\n  return dom\n}\n\nlet tag = (ns, name, ...args) => {\n  let [{is, ...props}, ...children] = protoOf(args[0] ?? 0) === objProto ? args : [{}, ...args]\n  let dom = ns ? document.createElementNS(ns, name, {is}) : document.createElement(name, {is})\n  for (let [k, v] of Object.entries(props)) {\n    let getPropDescriptor = proto => proto ?\n      Object.getOwnPropertyDescriptor(proto, k) ?? getPropDescriptor(protoOf(proto)) :\n      _undefined\n    let cacheKey = name + \",\" + k\n    let propSetter = propSetterCache[cacheKey] ??= getPropDescriptor(protoOf(dom))?.set ?? 0\n    let setter = k.startsWith(\"on\") ?\n      (v, oldV) => {\n        let event = k.slice(2)\n        dom.removeEventListener(event, oldV)\n        dom.addEventListener(event, v)\n      } :\n      propSetter ? propSetter.bind(dom) : dom.setAttribute.bind(dom, k)\n    let protoOfV = protoOf(v ?? 0)\n    k.startsWith(\"on\") || protoOfV === funcProto && (v = derive(v), protoOfV = stateProto)\n    protoOfV === stateProto ? bind(() => (setter(v.val, v._oldVal), dom)) : setter(v)\n  }\n  return add(dom, children)\n}\n\nlet handler = ns => ({get: (_, name) => tag.bind(_undefined, ns, name)})\n\nlet update = (dom, newDom) => newDom ? newDom !== dom && dom.replaceWith(newDom) : dom.remove()\n\nlet updateDoms = () => {\n  let iter = 0, derivedStatesArray = [...changedStates].filter(s => s.rawVal !== s._oldVal)\n  do {\n    derivedStates = new Set\n    for (let l of new Set(derivedStatesArray.flatMap(s => s._listeners = keepConnected(s._listeners))))\n      derive(l.f, l.s, l._dom), l._dom = _undefined\n  } while (++iter < 100 && (derivedStatesArray = [...derivedStates]).length)\n  let changedStatesArray = [...changedStates].filter(s => s.rawVal !== s._oldVal)\n  changedStates = _undefined\n  for (let b of new Set(changedStatesArray.flatMap(s => s._bindings = keepConnected(s._bindings))))\n    update(b._dom, bind(b.f, b._dom)), b._dom = _undefined\n  for (let s of changedStatesArray) s._oldVal = s.rawVal\n}\n\nexport default {\n  tags: new Proxy(ns => new Proxy(tag, handler(ns)), handler()),\n  hydrate: (dom, f) => update(dom, bind(f, dom)),\n  add, state, derive,\n}\n"],"names":[],"mappings":"AAAA;;AAEA;AACA,IAAI,OAAO,GAAG,MAAM,CAAC;AACrB,IAAI,aAAa,EAAE,aAAa,EAAE,OAAO,EAAE,aAAa,EAAE,kBAAkB,GAAG,CAAC,WAAW,EAAE,CAAC;AAC9F,IAAI,WAAW,GAAG,IAAI,EAAE,UAAU,EAAE,eAAe,GAAG;AACtD,IAAI,QAAQ,GAAG,OAAO,CAAC,kBAAkB,CAAC,EAAE,SAAS,GAAG,OAAO,CAAC,OAAO,CAAC,EAAE;;AAE1E,IAAI,qBAAqB,GAAG,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM;AAC9C,EAAE,CAAC,GAAG,KAAK,UAAU,CAAC,CAAC,EAAE,MAAM,CAAC,EAAE,IAAI,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC;;AAEjD,IAAI,iBAAiB,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,GAAG,KAAK;AAC1C,EAAE,IAAI,QAAQ,GAAG;AACjB,EAAE,OAAO,GAAG;AACZ,EAAE,IAAI;AACN,IAAI,OAAO,CAAC,CAAC,GAAG;AAChB,EAAE,CAAC,CAAC,OAAO,CAAC,EAAE;AACd,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC;AACnB,IAAI,OAAO;AACX,EAAE,CAAC,SAAS;AACZ,IAAI,OAAO,GAAG;AACd,EAAE;AACF;;AAEA,IAAI,aAAa,GAAG,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,WAAW;;AAE1D,IAAI,aAAa,GAAG,CAAC,IAAI,UAAU,GAAG,qBAAqB,CAAC,UAAU,EAAE,CAAC,EAAE,MAAM;AACjF,EAAE,KAAK,IAAI,CAAC,IAAI,UAAU;AAC1B,IAAI,CAAC,CAAC,SAAS,GAAG,aAAa,CAAC,CAAC,CAAC,SAAS,CAAC;AAC5C,IAAI,CAAC,CAAC,UAAU,GAAG,aAAa,CAAC,CAAC,CAAC,UAAU;AAC7C,EAAE,UAAU,GAAG;AACf,CAAC,EAAE,WAAW;;AAEd,IAAI,UAAU,GAAG;AACjB,EAAE,IAAI,GAAG,GAAG;AACZ,IAAI,OAAO,EAAE,QAAQ,EAAE,GAAG,CAAC,IAAI;AAC/B,IAAI,OAAO,IAAI,CAAC;AAChB,EAAE,CAAC;;AAEH,EAAE,IAAI,MAAM,GAAG;AACf,IAAI,OAAO,EAAE,QAAQ,EAAE,GAAG,CAAC,IAAI;AAC/B,IAAI,OAAO,IAAI,CAAC;AAChB,EAAE,CAAC;;AAEH,EAAE,IAAI,GAAG,CAAC,CAAC,EAAE;AACb,IAAI,OAAO,EAAE,QAAQ,EAAE,GAAG,CAAC,IAAI;AAC/B,IAAI,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,EAAE;AAC3B,MAAM,IAAI,CAAC,MAAM,GAAG;AACpB,MAAM,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM;AACpD,SAAS,aAAa,EAAE,GAAG,CAAC,IAAI,CAAC,EAAE,aAAa,GAAG,qBAAqB,CAAC,aAAa,EAAE,IAAI,EAAE,UAAU,CAAC;AACzG,QAAQ,IAAI,CAAC,OAAO,GAAG;AACvB,IAAI;AACJ,EAAE,CAAC;AACH;;AAEA,IAAI,KAAK,GAAG,OAAO,KAAK;AACxB,EAAE,SAAS,EAAE,UAAU;AACvB,EAAE,MAAM,EAAE,OAAO;AACjB,EAAE,OAAO,EAAE,OAAO;AAClB,EAAE,SAAS,EAAE,EAAE;AACf,EAAE,UAAU,EAAE,EAAE;AAChB,CAAC;;AAED,IAAI,IAAI,GAAG,CAAC,CAAC,EAAE,GAAG,KAAK;AACvB,EAAE,IAAI,IAAI,GAAG,CAAC,QAAQ,EAAE,IAAI,GAAG,EAAE,QAAQ,EAAE,IAAI,GAAG,CAAC,EAAE,OAAO,GAAG,CAAC,CAAC,CAAC,EAAE,cAAc,GAAG;AACrF,EAAE,aAAa,GAAG;AAClB,EAAE,IAAI,MAAM,GAAG,iBAAiB,CAAC,CAAC,EAAE,IAAI,EAAE,GAAG;AAC7C,EAAE,MAAM,GAAG,CAAC,MAAM,IAAI,QAAQ,EAAE,QAAQ,GAAG,MAAM,GAAG,IAAI,IAAI,CAAC,MAAM;AACnE,EAAE,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ;AAC7B,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,aAAa,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC;AACxE,EAAE,KAAK,IAAI,CAAC,IAAI,aAAa,EAAE,CAAC,CAAC,IAAI,GAAG;AACxC,EAAE,aAAa,GAAG;AAClB,EAAE,OAAO,OAAO,CAAC,IAAI,GAAG;AACxB;;AAEA,IAAI,MAAM,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,EAAE,GAAG,KAAK;AACtC,EAAE,IAAI,IAAI,GAAG,CAAC,QAAQ,EAAE,IAAI,GAAG,EAAE,QAAQ,EAAE,IAAI,GAAG,CAAC,EAAE,QAAQ,GAAG,CAAC,CAAC,EAAE,CAAC;AACrE,EAAE,QAAQ,CAAC,IAAI,GAAG,GAAG,IAAI,aAAa,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI;AAC1D,EAAE,CAAC,CAAC,GAAG,GAAG,iBAAiB,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,MAAM;AAC7C,EAAE,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ;AAC7B,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,aAAa,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC;AAC1E,EAAE,OAAO;AACT;;AAEA,IAAI,GAAG,GAAG,CAAC,GAAG,EAAE,GAAG,QAAQ,KAAK;AAChC,EAAE,KAAK,IAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;AACzC,IAAI,IAAI,QAAQ,GAAG,OAAO,CAAC,CAAC,IAAI,CAAC;AACjC,IAAI,IAAI,KAAK,GAAG,QAAQ,KAAK,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC;AAC3D,MAAM,QAAQ,KAAK,SAAS,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG;AACzC,IAAI,KAAK,IAAI,UAAU,IAAI,GAAG,CAAC,MAAM,CAAC,KAAK;AAC3C,EAAE;AACF,EAAE,OAAO;AACT;;AAEA,IAAI,GAAG,GAAG,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,IAAI,KAAK;AACjC,EAAE,IAAI,CAAC,CAAC,EAAE,EAAE,GAAG,KAAK,CAAC,EAAE,GAAG,QAAQ,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,QAAQ,GAAG,IAAI,GAAG,CAAC,EAAE,EAAE,GAAG,IAAI;AAC9F,EAAE,IAAI,GAAG,GAAG,EAAE,GAAG,QAAQ,CAAC,eAAe,CAAC,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC;AAC7F,EAAE,KAAK,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;AAC5C,IAAI,IAAI,iBAAiB,GAAG,KAAK,IAAI,KAAK;AAC1C,MAAM,MAAM,CAAC,wBAAwB,CAAC,KAAK,EAAE,CAAC,CAAC,IAAI,iBAAiB,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AACpF,MAAM;AACN,IAAI,IAAI,QAAQ,GAAG,IAAI,GAAG,GAAG,GAAG;AAChC,IAAI,IAAI,UAAU,GAAG,eAAe,CAAC,QAAQ,CAAC,KAAK,iBAAiB,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,IAAI;AAC3F,IAAI,IAAI,MAAM,GAAG,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC;AACnC,MAAM,CAAC,CAAC,EAAE,IAAI,KAAK;AACnB,QAAQ,IAAI,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;AAC7B,QAAQ,GAAG,CAAC,mBAAmB,CAAC,KAAK,EAAE,IAAI;AAC3C,QAAQ,GAAG,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;AACrC,MAAM,CAAC;AACP,MAAM,UAAU,GAAG,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;AACtE,IAAI,IAAI,QAAQ,GAAG,OAAO,CAAC,CAAC,IAAI,CAAC;AACjC,IAAI,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,QAAQ,KAAK,SAAS,KAAK,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,QAAQ,GAAG,UAAU;AACzF,IAAI,QAAQ,KAAK,UAAU,GAAG,IAAI,CAAC,OAAO,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,OAAO,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC;AACpF,EAAE;AACF,EAAE,OAAO,GAAG,CAAC,GAAG,EAAE,QAAQ;AAC1B;;AAEA,IAAI,OAAO,GAAG,EAAE,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,IAAI,KAAK,GAAG,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;;AAEvE,IAAI,MAAM,GAAG,CAAC,GAAG,EAAE,MAAM,KAAK,MAAM,GAAG,MAAM,KAAK,GAAG,IAAI,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,MAAM;;AAE7F,IAAI,UAAU,GAAG,MAAM;AACvB,EAAE,IAAI,IAAI,GAAG,CAAC,EAAE,kBAAkB,GAAG,CAAC,GAAG,aAAa,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,OAAO;AAC1F,EAAE,GAAG;AACL,IAAI,aAAa,GAAG,IAAI;AACxB,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,GAAG,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,UAAU,GAAG,aAAa,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;AACtG,MAAM,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,GAAG;AACzC,EAAE,CAAC,QAAQ,EAAE,IAAI,GAAG,GAAG,IAAI,CAAC,kBAAkB,GAAG,CAAC,GAAG,aAAa,CAAC,EAAE,MAAM;AAC3E,EAAE,IAAI,kBAAkB,GAAG,CAAC,GAAG,aAAa,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,OAAO;AAChF,EAAE,aAAa,GAAG;AAClB,EAAE,KAAK,IAAI,CAAC,IAAI,IAAI,GAAG,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,SAAS,GAAG,aAAa,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;AAClG,IAAI,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,GAAG;AAChD,EAAE,KAAK,IAAI,CAAC,IAAI,kBAAkB,EAAE,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC;AAClD;;AAEA,UAAe;AACf,EAAE,IAAI,EAAE,IAAI,KAAK,CAAC,EAAE,IAAI,IAAI,KAAK,CAAC,GAAG,EAAE,OAAO,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC;AAC/D,EAAE,OAAO,EAAE,CAAC,GAAG,EAAE,CAAC,KAAK,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;AAChD,EAAE,GAAG,EAAE,KAAK,EAAE,MAAM;AACpB;;;;","x_google_ignoreList":[0]}